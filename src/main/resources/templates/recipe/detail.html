<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<div id="main-wrapper">
	<div class="container">
		<div class="row">
			<table class="table">
				<tbody>
					<tr>
						<td class="text-center aln-center" colspan="3">
							<img th:src=${vo.poster} style="width:580px;height:370px;">
						</td>
					</tr>
					<tr>
						<td colspan="3" class="text-center"><h3>[[${vo.title}]]</h3></td>
					</tr>
					<tr>
						<td colspan=3>[[${vo.content}]]</td>
					</tr>
					<tr>
						<td class="text-center" width="33%"><img src="/images/a1.png"></td>
						<td class="text-center" width="34%"><img src="/images/a2.png"></td>
						<td class="text-center" width="33%"><img src="/images/a3.png"></td>
					</tr>
					<tr>
						<td class="text-center" width="33%">[[${vo.info1}]]</td>
						<td class="text-center" width="34%">[[${vo.info2}]]</td>
						<td class="text-center" width="33%">[[${vo.info3}]]</td>
					</tr>
				</tbody>
			</table>
			<table class="table">
				<tbody>
					<tr>
						<td colspan="2" class="text-center"><b>[조리순서]</b></td>
					</tr>
					<tr th:each="data,status:${mList}">
						<td class="text-letf" width=80%>[[${data}]]</td>
						<td class="text-right" width=20%>
						<img th:src="${nList[status.index]}" style="width:300px;height: 180px" onerror="this.src='/images/NoImage.jpg'">
						</td>					
					</tr>
					<!-- 
							status
							status.index => ArrayList의 인덱스
							status.count => ArrayList의 총갯수
							status.last => ArrayList의 저장된 마지막
							status.first => 첫번째 값
							status.even => 짝수번째
							status.odd  => 홀수
							
							=> StringTokenizer
							=> <c:forTokens>
							=> ${#string.split(문자열,'구분자')}
					 -->
				</tbody>
			</table>
			<table class="table">
				<tr>
					<td width=20% class="text-left" rowspan="2">
					<a th:href="@{/recipe/chef_list(chef=${vo.chef})}"><img th:src="${vo.chef_poster}" style="width:100px;height:100px" class="img-circle"></a>
					</td>
					<td width=80%>[[${vo.chef}]]</td>
				</tr>
				<tr>
					<td width=80%>[[${vo.chef_profile}]]</td>
				</tr>
			</table>
		</div>
		<div class="row aln-center" style="margin-top:-15px">
		<table th:if="${session.id!=null}">
			<tbody>
			<tr>
				<td style="display: flex;justify-content: center">
					<textarea rows="4" cols="120" style="float:left;resize: none;border-radius:7px;"  v-model="msg" ref="msg"></textarea>
					<button type="button" class="btn-primary" style="width:100px;height:87px;float:left" @click="insert()">댓글쓰기</button>
				</td>
			</tr>
			</tbody>
		</table>
		<table class="table">
			<tbody>
				<tr>
					<td>
						<table class="table" v-for="rvo in list">
							<tr>
								<td class="text-left" width=80%>
									((rvo.name))&nbsp;((rvo.dbday))
								</td>
								<td width="20%" class="text-right">
									<span v-if="sessionId===rvo.id">
										<button type=button class="btn btn-xs btn-warning upbtn" :id="`u`+rvo.no" @click="replyUpdateForm(rvo.no)">수정</button>
										<button type=button class="btn btn-xs btn-info" @click="this.delete(rvo.no)">삭제</button>
									</span>
								</td>
							</tr>
							<tr>
								<td colspan="2" class="text-left">
									<pre style="white-space: pre-wrap;background-color: white;border:none;">((rvo.msg))</pre>
								</td>
							</tr>
							<tr style="display:none" class="ups" :id="`umsg`+rvo.no">
								<td colspan=2 class="aln-center">
									<table>
										<tbody>
											<tr>
												<td style="display: flex;justify-content: center">
													<textarea rows="2" cols="120" style="float:left;resize: none;border-radius:7px;" :id="`ups`+rvo.no">((rvo.msg))</textarea>
													<button type="button" class="btn-primary" style="width:100px;height:87px;float:left" @click="replyupdate(rvo.no)">댓글쓰기</button>
												</td>
											</tr>
										</tbody>
									</table>
								<td>
							</tr>
						</table>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<script>
		const commentApp = Vue.createApp({
			// Model = 데이터 관리 => 변수가 변경이 되면 => HTML에 적용
			// 상태(변수) 관리 프로그램
			data(){
				return{
					//멤버 변수
					list :[],
					cno : '[[${vo.no}]]',
					type : 2,
					sessionId:'[[${sessionId}]]',
					msg :'',
					up:false
				}
			},
			//////// VM => 변수를 변경하는 곳
			/*
					callback : Vue의 생명
					= created() : 설정 => Vue객체 생성완료
					= mounted() : 브라우저에서 HTML을 번역후 출력 완료
					= updated() : 멤버변수가 변경된 경우
					= unmounted() : 화면 변경 => Vue객체가 소멸
					
					사용자 요청 === VM 작업 === 결과값 : Model === View(Html)
					
					가상돔 => 일부만 관리
					---- 임시메모리에 저장 ====== 실제 돔 (브라우저에서 읽어서 출력)
							  |					|
							저장 -----------------
											비교해서 다른 부분만 변경
					=> 시리얼라이즈 : Buffered
					   --------------------
					=> 게임 (더블 버퍼링)
					*/
			mounted(){
					this.getData()
				// 자동 호출 : window.onload => 연동 / 서버 연결
				// jquery / react 
				/*
					$(function(){
						$('#a').click(function(){})
					})
					
					
					=>
					useEffect(()=>{
						axios.get()
					}),[curPage]
					query([curPage],function(){})
				*/
			},
			methods:{
				getData(){
					axios.get('http://localhost/comment/list_vue/',{
						params:{
							cno:this.cno,
							type:this.type
						}
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
				},
				insert(){
					
					if(this.msg==='')
					{
						this.$refs.msg.focus()
						return
					}
					axios.post('http://localhost/comment/insert_vue/',{
						cno:this.cno,
						type:this.type,
						msg:this.msg
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
					this.msg=''
				},
				delete(no){
					$('.ups').hide()
					$('.upbtn').text("수정")
					axios.get('http://localhost/comment/delete_vue/',{
						params:{
							no:no,
							cno:this.cno,
							type:this.type
						}
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
				},
				replyUpdateForm(no){
					$('.ups').hide()
					$('.upbtn').text("수정")
					if(this.up===false)
					{
						this.up=true
						$('#umsg'+no).show()
						$('#u'+no).text("취소")
					}
					else{
						if($('#umsg'+no).is(":hidden"))
						{
							$('#umsg'+no).show()
							$('#u'+no).text("취소")
						}
						else
						{
							this.up=false
							$('#umsg'+no).hide()
							$('#u'+no).text("수정")
						
						}	
					}
				},
				replyupdate(no){
						let msg=$('#ups'+no).val()
						if(msg==="")
						{
							$('#ups'+no).focus()
							return
						}
						axios.post('http://localhost/comment/update_vue/',{
							cno:this.cno,type:this.type,msg:msg,no:no
						}).then(response=>{
							console.log(response.data)
							this.list=response.data.list
							this.cno=response.data.cno
							this.type=response.data.type
							$('.ups').hide()
							$('.upbtn').text("수정")
						})
				}
				// 사용자 정의 기능 => 요청 처리
			},
			computed:{
				// 시간 , 가격 , 총 금액 = > Format
			},
			components:{
				// 여러개의 기능을 처리 => include
			}
			// HTML 출력하는 영역 => <template> => View => MVVM
		})
		commentApp.config.compilerOptions.delimiters=['((','))']
		commentApp.mount("#main-wrapper")
	</script>
	</div>
</div>
</body>
</html>