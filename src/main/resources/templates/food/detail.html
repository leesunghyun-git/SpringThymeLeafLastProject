<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<div id="main-wrapper">
	<div class="container">
		<div class="row aln-center">
			<table class="table">
				<tbody>
				<tr>
					<td class="text-center" rowspan="9" width=30%>
					<img th:src="${vo.poster}" style="width:300px;height:250px">
					</td>
					<td colspan="2">
					<h3>[[${vo.name}]] <span style="color:orange;font-size:0.8em">[[${vo.score}]]</span></h3>
					</td>
				</tr>
				<tr>
					<th width=10%>주소</th>
					<td width="60%" class="aln-left">[[${vo.address}]]</td>
				</tr>
				<tr>
					<th width=10%>전화</th>
					<td width="60%" class="aln-left">[[${vo.phone}]]</td>
				</tr>
				<tr>
					<th width=10%>음식종류</th>
					<td width="60%" class="aln-left">[[${vo.type}]]</td>
				</tr>
				<tr>
					<th width=10%>가격대</th>
					<td width="60%" class="aln-left">[[${vo.price}]]</td>
				</tr>
				<tr>
					<th width=10%>주차</th>
					<td width="60%" class="aln-left">[[${vo.parking}]]</td>
				</tr>
				<tr>
					<th width=10%>영업 시간</th>
					<td width="60%" class="aln-left">[[${vo.time}]]</td>
				</tr>
				<tr>
					<th width=10%>테마</th>
					<td width="60%" class="aln-left">[[${vo.theme}]]</td>
				</tr>
				<tr>
					<th width=10%>조회수</th>
					<td width="60%" class="aln-left">
						<img src="/images/likeon.png" style="width:20px;height:20px;">&nbsp;[[${vo.hit}]]
					</td>
				</tr>
				</tbody>
			</table>
			<table class="table">
				<tbody>
					<tr>
						<td>
							[[${vo.content}]]
						</td>
					</tr>
					<tr>
						<td class="text-right">
							<a href="#" class="btn btn-sm btn-danger">찜하기</a>
							<a href="#" class="btn btn-sm btn-info">예약하기</a>
							<a href="javascript:history.back()" class="btn btn-sm btn-warning">목록</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="row aln-center" style="margin-top:-15px">
		<table th:if="${session.id!=null}">
			<tbody>
			<tr>
				<td style="display: flex;justify-content: center">
					<textarea rows="4" cols="120" style="float:left;resize: none;border-radius:7px;"  v-model="msg" ref="msg"></textarea>
					<button type="button" class="btn-primary" style="width:100px;height:87px;float:left" @click="insert()">댓글쓰기</button>
				</td>
			</tr>
			</tbody>
		</table>
		<table class="table">
			<tbody>
				<tr>
					<td>
						<table class="table" v-for="rvo in list">
							<tr>
								<td class="text-left" width=80%>
									((rvo.name))&nbsp;((rvo.dbday))
								</td>
								<td width="20%" class="text-right">
									<span v-if="sessionId===rvo.id">
										<button type=button class="btn btn-xs btn-warning upbtn" :id="`u`+rvo.no" @click="replyUpdateForm(rvo.no)">수정</button>
										<button type=button class="btn btn-xs btn-info" @click="this.delete(rvo.no)">삭제</button>
									</span>
								</td>
							</tr>
							<tr>
								<td colspan="2" class="text-left">
									<pre style="white-space: pre-wrap;background-color: white;border:none;">((rvo.msg))</pre>
								</td>
							</tr>
							<tr style="display:none" class="ups" :id="`umsg`+rvo.no">
								<td colspan=2 class="aln-center">
									<table>
										<tbody>
											<tr>
												<td style="display: flex;justify-content: center">
													<textarea rows="2" cols="120" style="float:left;resize: none;border-radius:7px;" :id="`ups`+rvo.no">((rvo.msg))</textarea>
													<button type="button" class="btn-primary" style="width:100px;height:87px;float:left" @click="replyupdate(rvo.no)">댓글쓰기</button>
												</td>
											</tr>
										</tbody>
									</table>
								<td>
							</tr>
						</table>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<script>
		const commentApp = Vue.createApp({
			// Model = 데이터 관리 => 변수가 변경이 되면 => HTML에 적용
			// 상태(변수) 관리 프로그램
			data(){
				return{
					//멤버 변수
					list :[],
					cno : '[[${vo.fno}]]',
					type : 1,
					sessionId:'[[${sessionId}]]',
					msg :'',
				}
			},
			//////// VM => 변수를 변경하는 곳
			/*
					callback : Vue의 생명
					= created() : 설정 => Vue객체 생성완료
					= mounted() : 브라우저에서 HTML을 번역후 출력 완료
					= updated() : 멤버변수가 변경된 경우
					= unmounted() : 화면 변경 => Vue객체가 소멸
					
					사용자 요청 === VM 작업 === 결과값 : Model === View(Html)
					
					가상돔 => 일부만 관리
					---- 임시메모리에 저장 ====== 실제 돔 (브라우저에서 읽어서 출력)
							  |					|
							저장 -----------------
											비교해서 다른 부분만 변경
					=> 시리얼라이즈 : Buffered
					   --------------------
					=> 게임 (더블 버퍼링)
					*/
			mounted(){
					this.getData()
				// 자동 호출 : window.onload => 연동 / 서버 연결
				// jquery / react 
				/*
					$(function(){
						$('#a').click(function(){})
					})
					
					
					=>
					useEffect(()=>{
						axios.get()
					}),[curPage]
					query([curPage],function(){})
				*/
			},
			methods:{
				getData(){
					axios.get('http://localhost/comment/list_vue/',{
						params:{
							cno:this.cno,
							type:this.type
						}
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
				},
				insert(){
					
					if(this.msg==='')
					{
						this.$refs.msg.focus()
						return
					}
					axios.post('http://localhost/comment/insert_vue/',{
						cno:this.cno,
						type:this.type,
						msg:this.msg
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
					this.msg=''
				},
				delete(no){
					$('.ups').hide()
					$('.upbtn').text("수정")
					axios.get('http://localhost/comment/delete_vue/',{
						params:{
							no:no,
							cno:this.cno,
							type:this.type
						}
					}).then(response=>{
						console.log(response.data)
						this.list=response.data.list
						this.cno=response.data.cno
						this.type=response.data.type
					})
				},
				replyUpdateForm(no){
					if($('#umsg'+no).is(":hidden"))
					{
						$('.ups').hide()
						$('.upbtn').text("수정")
						$('#umsg'+no).show()
						$('#u'+no).text("취소")
					}
					else{
						$('.ups').hide()
						$('.upbtn').text("수정")
						$('#umsg'+no).hide()
						$('#u'+no).text("수정")
					}
					
				},
				replyupdate(no){
						let msg=$('#ups'+no).val()
						if(msg==="")
						{
							$('#ups'+no).focus()
							return
						}
						axios.post('http://localhost/comment/update_vue/',{
							cno:this.cno,type:this.type,msg:msg,no:no
						}).then(response=>{
							console.log(response.data)
							this.list=response.data.list
							this.cno=response.data.cno
							this.type=response.data.type
							$('.ups').hide()
							$('.upbtn').text("수정")
						})
				}
				// 사용자 정의 기능 => 요청 처리
			},
			computed:{
				// 시간 , 가격 , 총 금액 = > Format
			},
			components:{
				// 여러개의 기능을 처리 => include
			}
			// HTML 출력하는 영역 => <template> => View => MVVM
		})
		commentApp.config.compilerOptions.delimiters=['((','))']
		commentApp.mount("#main-wrapper")
	</script>
	</div>
</div>
</body>
</html>